# Restaurant-Discounts

Restaurant-Discounts/
├─ apps/
│ └─ web/ # Next.js (App Router) app — UI + API routes
│ ├─ app/ # App Router tree (routes = folders)
│ │ ├─ layout.tsx # global shell (fonts, <html>, <body>, providers)
│ │ ├─ page.tsx # "/" – restaurant list (links to details)
│ │ ├─ admin/ # "/admin" – manual refresh UI (dev only)
│ │ │ └─ page.tsx # date input + POST /api/admin/refresh
│ │ └─ restaurants/
│ │ └─ [id]/ # "/restaurants/:id" – restaurant details
│ │ ├─ page.tsx # server-render discounts table (+date switcher)
│ │ ├─ loading.tsx # optional skeleton while route loads
│ │ └─ error.tsx # optional error boundary for this route
│ │
│ │ └─ api/ # Server-only route handlers (Edge/Node)
│ │ ├─ admin/
│ │ │ └─ refresh/route.ts # POST: bulk refresh via model-server
│ │ └─ restaurants/
│ │ └─ [id]/
│ │ └─ discounts/route.ts # GET: read by date; POST: save accepted rows
│ │
│ ├─ public/ # Static assets (svgs, icons, etc.)
│ │ └─ favicon.ico
│ ├─ src/
│ │ ├─ lib/ # shared logic (isomorphic/server utils)
│ │ │ ├─ fetchers.ts # server/client fetch helpers (discounts, refresh)
│ │ │ ├─ modelServer.ts # client to FastAPI /v1/generate
│ │ │ ├─ restaurants.ts # in-memory catalog + openingHoursToList()
│ │ │ ├─ store.ts # temp in-mem persistence (to be Prisma)
│ │ │ └─ time.ts # todayYMD(), date helpers
│ │ └─ ui/ # small building blocks (optional)
│ │ ├─ Button.tsx # basic button
│ │ ├─ DateInput.tsx # controlled <input type="date" />
│ │ └─ Table.tsx # simple table wrapper
│ │
│ ├─ .env.local # local vars (CRON_SECRET, MODEL_SERVER_URL, etc.)
│ ├─ .env.example # documented required/optional keys
│ ├─ next.config.ts
│ ├─ tsconfig.json
│ ├─ postcss.config.mjs
│ ├─ eslint.config.mjs
│ └─ package.json
│
├─ services/
│ └─ model-server/ # Python FastAPI service (ML “brain”)
│ ├─ app.py # /v1/generate: loads model, builds features, predicts
│ ├─ models/ # model artifacts registry
│ │ ├─ pasta-place/
│ │ │ └─ 0004_customer_demand_pipeline.pkl
│ │ ├─ sunset-grill/
│ │ │ └─ 0003_customer_demand_pipeline.pkl
│ │ └─ sushi-house/
│ │ └─ 0005_customer_demand_pipeline.pkl
│ ├─ pasta_place_2YEAR_data.json # training data (kept here for retraining)
│ ├─ sunset_grill_2YEAR_data.json
│ ├─ sushi_house_2YEAR_data.json
│ ├─ train.ipynb # HGBR pipeline + CV + export .pkl via joblib
│ ├─ requirements.txt # fastapi, uvicorn, scikit-learn, pandas, numpy, joblib…
│ ├─ venv/ # local venv (gitignored)
│ └─ README.md # how to run/train the service
│
├─ prisma/ # (planned) DB schema + migrations
│ ├─ schema.prisma # restaurants, accepted_discounts, reservations, etc.
│ ├─ migrations/ # generated by `prisma migrate`
│ └─ seed.ts # seed dev data
│
├─ scripts/ # helper scripts (optional)
│ ├─ dev.sh # run Next + model-server together
│ ├─ refresh.sh # curl POST /api/admin/refresh with date/header
│ └─ train-all.sh # batch training wrapper (notebook or .py)
│
├─ .gitignore # node_modules, .next, venv, \*.pkl, .DS_Store, etc.
└─ README.md # top-level overview & getting-started

---

Restaurant-Discounts/
├─ apps/
│ └─ web/ # Next.js frontend + API routes (migrated from React)
│ ├─ app/ # ✅ already exists, core Next.js "App Router"
│ │ ├─ layout.tsx # ✅ global shell (html/body/providers) – DONE
│ │ ├─ page.tsx # ✅ "/" restaurant list page – NEEDS styling/data fetch
│ │ ├─ admin/ # NEW – manual admin UI
│ │ │ └─ page.tsx # 🆕 added: form to POST /api/admin/refresh – NEED polish
│ │ └─ restaurants/
│ │ └─ [id]/ # ✅ per-restaurant route
│ │ ├─ page.tsx # 🆕 added: shows discounts table – NEEDS UI work
│ │ ├─ loading.tsx # 🆕 skeleton loader – optional
│ │ └─ error.tsx # 🆕 error boundary – optional
│ │
│ │ └─ api/ # ✅ Next.js API handlers (already wired to model-server)
│ │ ├─ admin/
│ │ │ └─ refresh/route.ts # ✅ bulk refresh – DONE & tested
│ │ └─ restaurants/
│ │ └─ [id]/
│ │ └─ discounts/route.ts # ✅ GET/POST discounts – DONE
│ │
│ ├─ public/ # ✅ static assets
│ │ └─ favicon.ico
│ ├─ src/
│ │ ├─ lib/ # ✅ util layer
│ │ │ ├─ fetchers.ts # 🆕 added: central API fetchers – NEED integration in pages
│ │ │ ├─ modelServer.ts # ✅ FastAPI client wrapper – DONE
│ │ │ ├─ restaurants.ts # ✅ restaurant catalog + helpers – DONE
│ │ │ ├─ store.ts # ✅ in-memory store – TEMP, will swap for Prisma
│ │ │ └─ time.ts # ✅ date helpers – DONE
│ │ └─ ui/ # 🆕 new directory for small UI components
│ │ ├─ Button.tsx # 🆕 scaffolded – NEED to flesh out styles
│ │ ├─ DateInput.tsx # 🆕 scaffolded – used by admin form
│ │ └─ Table.tsx # 🆕 scaffolded – used by [id]/page.tsx
│ │
│ ├─ .env.local # ✅ already present – NEEDS MODEL_SERVER_URL
│ ├─ .env.example # ✅ documented keys
│ ├─ next.config.ts, tsconfig.json, postcss.config.mjs, eslint.config.mjs
│ └─ package.json # ✅ frontend deps
│
├─ services/
│ └─ model-server/ # ✅ FastAPI ML microservice
│ ├─ app.py # ✅ FastAPI app (with /v1/generate) – WORKING
│ ├─ models/ # ✅ trained pipelines (joblib .pkl files)
│ │ ├─ pasta-place/0004_customer_demand_pipeline.pkl
│ │ ├─ sunset-grill/0003_customer_demand_pipeline.pkl
│ │ └─ sushi-house/0005_customer_demand_pipeline.pkl
│ ├─ \*\_2YEAR_data.json # ✅ datasets (train/test) – ALREADY LOADED
│ ├─ train.ipynb # ✅ retraining notebook – NEED hyperparam tuning & cleanup
│ ├─ requirements.txt # ✅ all Python deps
│ ├─ venv/ # ✅ local-only, gitignored
│ └─ README.md # 🆕 should add training + run docs – NOT WRITTEN
│
├─ prisma/ # 🚧 not yet wired in
│ ├─ schema.prisma # 🆕 to be written (restaurants, bookings, accepted_discounts)
│ ├─ migrations/ # empty until first `prisma migrate`
│ └─ seed.ts # 🆕 placeholder – will seed restaurant + table data
│
├─ scripts/ # 🆕 helper scripts (optional but recommended)
│ ├─ dev.sh # 🆕 run Next + model-server together – NOT WRITTEN
│ ├─ refresh.sh # 🆕 curl wrapper for /admin/refresh – NOT WRITTEN
│ └─ train-all.sh # 🆕 batch retrain models – NOT WRITTEN
│
├─ .gitignore # ✅ ignoring node_modules, .next, venv, .pkl, etc.
└─ README.md # 🆕 top-level overview – NOT WRITTEN
